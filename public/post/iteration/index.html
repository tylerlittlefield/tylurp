<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>Iteration the Easy Way :: tyler littlefield</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="I do not come from a computer science background but my guess is that base R’s apply family of functions stand out as something strange. This strangeness might be because for loops are explicit and make it clear what’s going on, so why obfuscate the logic?
But on the other hand, I think you could argue that while the logic might be clear, the intent isn’t, at least not immediately."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/post/iteration/" />





<link rel="stylesheet" href="/assets/style.css">


<link rel="stylesheet" href="/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/img/favicon.png">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Iteration the Easy Way"/>
<meta name="twitter:description" content="I do not come from a computer science background but my guess is that base R’s apply family of functions stand out as something strange. This strangeness might be because for loops are explicit and make it clear what’s going on, so why obfuscate the logic?
But on the other hand, I think you could argue that while the logic might be clear, the intent isn’t, at least not immediately."/>



<meta property="og:title" content="Iteration the Easy Way" />
<meta property="og:description" content="I do not come from a computer science background but my guess is that base R’s apply family of functions stand out as something strange. This strangeness might be because for loops are explicit and make it clear what’s going on, so why obfuscate the logic?
But on the other hand, I think you could argue that while the logic might be clear, the intent isn’t, at least not immediately." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/iteration/" />
<meta property="article:published_time" content="2019-09-01T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-09-01T00:00:00+00:00" /><meta property="og:site_name" content="tyler littlefield" />





<link rel="stylesheet" href="/css/code/zenburn.css" rel="stylesheet" id="theme-stylesheet">
<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


  </head>
  <body class="">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">tyler littlefield</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
      
        <ul class="menu__sub-inner">
          <li class="menu__sub-inner-more-trigger">
            Show more
            <span class="menu__sub-inner-more-trigger-icon"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
          </li>

          <ul class="menu__sub-inner-more hidden">
            
              
                <li><a href="/archive">Archive</a></li>
              
            
              
                <li><a href="https://www.tylerlittlefield.com/rstudio">RStudio</a></li>
              
            
              
                <li><a href="/showcase">Showcase</a></li>
              
            
          </ul>
        </ul>
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="/archive">Archive</a></li>
      
    
      
        <li><a href="https://www.tylerlittlefield.com/rstudio">RStudio</a></li>
      
    
      
        <li><a href="/showcase">Showcase</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  <div class="post">
    <h2 class="post-title"><a href="/post/iteration/">Iteration the Easy Way</a></h2>
    <div class="post-meta">
      
        <span class="post-date">
            2019-09-01
        </span>
      
      
      
    </div>

    
      <span class="post-tags">
        
          #<a href="/tags/rstats/">rstats</a>&nbsp;
        
          #<a href="/tags/iteration/">iteration</a>&nbsp;
        
      </span>
    

    

    <div class="post-content">
      


<p>I do not come from a computer science background but my guess is that base R’s <code>apply</code> family of functions stand out as something strange. This strangeness might be because for loops are explicit and make it clear what’s going on, so why obfuscate the logic?</p>
<p>But on the other hand, I think you could argue that while the logic might be clear, the intent isn’t, at least not immediately. This might be one reason functions like <code>lapply</code> exist, because at it’s heart R is a functional programming language and R users value <em>functionals</em> because they express the intent and allow us to think functionally.</p>
<p>Take the example below, we take every element in a list <code>mylist</code> and convert it to uppercase.</p>
<pre class="r"><code>mylist &lt;- list(
  a = letters[1:10],
  b = letters[11:20]
)

mylist
#&gt; $a
#&gt;  [1] &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot; &quot;e&quot; &quot;f&quot; &quot;g&quot; &quot;h&quot; &quot;i&quot; &quot;j&quot;
#&gt; 
#&gt; $b
#&gt;  [1] &quot;k&quot; &quot;l&quot; &quot;m&quot; &quot;n&quot; &quot;o&quot; &quot;p&quot; &quot;q&quot; &quot;r&quot; &quot;s&quot; &quot;t&quot;</code></pre>
<p>With <code>lapply</code> we would do something like:</p>
<pre class="r"><code>lapply(mylist, toupper)
#&gt; $a
#&gt;  [1] &quot;A&quot; &quot;B&quot; &quot;C&quot; &quot;D&quot; &quot;E&quot; &quot;F&quot; &quot;G&quot; &quot;H&quot; &quot;I&quot; &quot;J&quot;
#&gt; 
#&gt; $b
#&gt;  [1] &quot;K&quot; &quot;L&quot; &quot;M&quot; &quot;N&quot; &quot;O&quot; &quot;P&quot; &quot;Q&quot; &quot;R&quot; &quot;S&quot; &quot;T&quot;</code></pre>
<p>With a for loop we would do something like:</p>
<pre class="r"><code>for (i in seq_along(mylist)) {
  mylist[[i]] &lt;- toupper(mylist[[i]])
}

mylist
#&gt; $a
#&gt;  [1] &quot;A&quot; &quot;B&quot; &quot;C&quot; &quot;D&quot; &quot;E&quot; &quot;F&quot; &quot;G&quot; &quot;H&quot; &quot;I&quot; &quot;J&quot;
#&gt; 
#&gt; $b
#&gt;  [1] &quot;K&quot; &quot;L&quot; &quot;M&quot; &quot;N&quot; &quot;O&quot; &quot;P&quot; &quot;Q&quot; &quot;R&quot; &quot;S&quot; &quot;T&quot;</code></pre>
<p>With <code>lapply</code> we are taking a function as input and applying it to every list element. It can be read as, applying the <code>toupper</code> function to everything in my list. With the for loop, we immediatly understand iteration is happening but we must decipher the logic to identify the intent, this becomes more difficult with larger or nested for loops.</p>
<p>The concept of functionals, a function that takes a function as input, is powerful and has dramatically changed the way I’ve written R code. Prior to this realization, I would tirelessly write for loops to capture everything I need from a list and there were 2 problems with this:</p>
<ol style="list-style-type: decimal">
<li>I would cram as much functionality as I could into a single loop, i.e. sort each vector, take the top 3 values, compute the mean, assign to another object, take that object and multiply it by this other object, etc. The intent would degrade and the loop would become a, <em>“just do everything and solve all my problems”</em> loop.</li>
<li>Coming back to the loop is difficult to understand and I often never reused them.</li>
</ol>
<p>Now, point 1 isn’t necessarily the for loops fault, it’s my fault for cramming everything into a single loop. But maybe there is something to say about why I chose this approach in the first place. For me, I think it was something along the lines of, <em>“I’m already iterating, why step outside of the loop when I can carry on.”</em> And maybe this is why I embrace the <code>apply</code> functions, because they force me to think about the intent in small, bite sized steps.</p>
<p>Of course, you could fall into the same trap and just make giant, convoluted functions and feed them to <code>lapply</code>. Yet, for some reason, I never had this problem. Perhaps this has to do with the fact that you must name your function and if you can’t come up with a sensible name, it’s clear your function is doing too much.</p>
<p>Another idea I’ve come to love is, <em>“if you can do it once, you can iterate.”</em> When I need to iterate over something, I use the following workflow:</p>
<ol style="list-style-type: decimal">
<li>Take the first element, i.e. <code>mylist[[1]]</code>.</li>
<li>Write some code to get what you need, no functions or anything, just a script.</li>
<li>Wrap that code into meaningful functions that have a clear intent.</li>
<li>Feed those functions to <code>lapply</code>!</li>
</ol>
<p>For example, let’s say we have a list and for every element in that list we want to sort and then convert to uppercase. We could easily do this for the first element like so:</p>
<pre class="r"><code>mylist &lt;- list(
  a = sample(letters, 10),
  b = sample(letters, 10)
)

mylist2 &lt;- mylist[[1]]
mylist2 &lt;- sort(mylist2)[1:3]
toupper(mylist2)
#&gt; [1] &quot;A&quot; &quot;B&quot; &quot;E&quot;</code></pre>
<p>Now we wrap our sorting logic into a function:</p>
<pre class="r"><code>my_sort &lt;- function(x, n) {
  sort(x)[1:n]
}</code></pre>
<p>Finally, we take our function and feed it to <code>lapply</code>. Since we can do it to one element, we can do it to the rest:</p>
<pre class="r"><code>mylist &lt;- lapply(mylist, my_sort, n = 3)
lapply(mylist, toupper)
#&gt; $a
#&gt; [1] &quot;A&quot; &quot;B&quot; &quot;E&quot;
#&gt; 
#&gt; $b
#&gt; [1] &quot;A&quot; &quot;C&quot; &quot;E&quot;</code></pre>
<p>This approach to iteration has been a life saver as I no longer worry about the logic of capturing everything in my list, I just worry about how the logic can be applied to a single element.</p>
<p>While we haven’t covered the <code>purrr</code> package and pipes, I’d like to share one example of how enjoyable iteration can be when combined with pipes:</p>
<pre class="r"><code>library(dplyr)
library(purrr)

mylist %&gt;% 
  map(my_sort, 3) %&gt;% 
  map(toupper)
#&gt; $a
#&gt; [1] &quot;A&quot; &quot;B&quot; &quot;E&quot;
#&gt; 
#&gt; $b
#&gt; [1] &quot;A&quot; &quot;C&quot; &quot;E&quot;</code></pre>
<p>This could be read as, <em>“I take my list <strong>then</strong> map my sorting function <strong>then</strong> map the toupper function.”</em> I find that pipes make the intent even more clear as the step by step based syntax is familiar to many.</p>

    </div>
    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="/post/comparing-sets/">
                <span class="button__icon">←</span>
                <span class="button__text">Comparing Sets</span>
              </a>
            </span>
          
          
            <span class="button next">
              <a href="/post/my-first-cran-package/">
                <span class="button__text">My First CRAN Package</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
    

    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">tyler littlefield</span>
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span>© 2019 Powered by <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a></span>
        <span>Theme created by <a href="https://twitter.com/panr" target="_blank" rel="noopener">panr</a></span>
      </div>
    
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>


      
    </div>

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-106175087-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
  </body>
</html>
