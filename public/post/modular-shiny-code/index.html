<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>Modular Shiny Code :: tylerlittlefield</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Intro In 2016, Garrett Grolemond gave a talk at the very first Shiny Developer Conference in Palo Alto, California. The first slide in his presentation read in big bold letters, “Writing Big Apps, How to use Shiny Modules”. You can find the slides here and a video of the talk here.
In a nutshell, shiny modules allow users to write composable shiny code. Little bite size pieces of code that can be reused and brought together to work as a whole."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/post/modular-shiny-code/" />





<link rel="stylesheet" href="/assets/style.css">


<link rel="stylesheet" href="/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/img/favicon.png">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Modular Shiny Code"/>
<meta name="twitter:description" content="Intro In 2016, Garrett Grolemond gave a talk at the very first Shiny Developer Conference in Palo Alto, California. The first slide in his presentation read in big bold letters, “Writing Big Apps, How to use Shiny Modules”. You can find the slides here and a video of the talk here.
In a nutshell, shiny modules allow users to write composable shiny code. Little bite size pieces of code that can be reused and brought together to work as a whole."/>



<meta property="og:title" content="Modular Shiny Code" />
<meta property="og:description" content="Intro In 2016, Garrett Grolemond gave a talk at the very first Shiny Developer Conference in Palo Alto, California. The first slide in his presentation read in big bold letters, “Writing Big Apps, How to use Shiny Modules”. You can find the slides here and a video of the talk here.
In a nutshell, shiny modules allow users to write composable shiny code. Little bite size pieces of code that can be reused and brought together to work as a whole." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/modular-shiny-code/" />
<meta property="article:published_time" content="2019-01-03T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-01-03T00:00:00+00:00" /><meta property="og:site_name" content="tylerlittlefield" />






<link rel="stylesheet" href="/css/code/zenburn.css" rel="stylesheet" id="theme-stylesheet">
<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">

  </head>
  <body class="">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">tyler littlefield</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
      
        <ul class="menu__sub-inner">
          <li class="menu__sub-inner-more-trigger">
            Show more
            <span class="menu__sub-inner-more-trigger-icon"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
          </li>

          <ul class="menu__sub-inner-more hidden">
            
              
                <li><a href="/archive">Archive</a></li>
              
            
              
                <li><a href="https://www.tylerlittlefield.com/rstudio">RStudio</a></li>
              
            
              
                <li><a href="/showcase">Showcase</a></li>
              
            
          </ul>
        </ul>
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="/archive">Archive</a></li>
      
    
      
        <li><a href="https://www.tylerlittlefield.com/rstudio">RStudio</a></li>
      
    
      
        <li><a href="/showcase">Showcase</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  <div class="post">
    <h2 class="post-title"><a href="/post/modular-shiny-code/">Modular Shiny Code</a></h2>
    <div class="post-meta">
      
        <span class="post-date">
            2019-01-03
        </span>
      
      
      
    </div>

    
      <span class="post-tags">
        
          #<a href="/tags/rstats/">rstats</a>&nbsp;
        
          #<a href="/tags/shiny/">shiny</a>&nbsp;
        
          #<a href="/tags/modular/">modular</a>&nbsp;
        
      </span>
    

    

    <div class="post-content">
      


<div id="intro" class="section level2">
<h2>Intro</h2>
<p>In 2016, Garrett Grolemond gave a talk at the very first Shiny Developer Conference in Palo Alto, California. The first slide in his presentation read in big bold letters, <em>“Writing Big Apps, How to use Shiny Modules”</em>. You can find the slides <a href="https://github.com/rstudio/ShinyDeveloperConference/blob/master/Modules/01-Modules.pdf"><strong>here</strong></a> and a video of the talk <a href="https://www.rstudio.com/resources/webinars/shiny-developer-conference/"><strong>here</strong></a>.</p>
<p>In a nutshell, shiny modules allow users to write composable shiny code. Little bite size pieces of code that can be reused and brought together to work as a whole. The idea is exciting because self contained chunks of shiny code are easier to manage when apps become large and complex.</p>
</div>
<div id="why-not-write-functions" class="section level2">
<h2>Why not write functions?</h2>
<p>I mean R is a functional programming language, just make functions! Well, the problem stems from the fact that shiny input and output IDs all share a global namespace. As a consequence, these IDs must be unique when creating functions that produce inputs and outputs otherwise, the IDs collide. This problem of providing spaces for names logically and without collision is solved by shiny modules. In other words, shiny modules adds namespacing to shiny! This is why functions aren’t enough. See Joe Cheng’s post <a href="https://shiny.rstudio.com/articles/modules.html"><strong>here</strong></a> as he eloquently explains the namespace problem with shiny. For even more detail on namespaces, see Hadley Wickham’s namespace chapter in his R packages book <a href="http://r-pkgs.had.co.nz/namespace.html"><strong>here</strong></a>.</p>
<p>Oh and by the way, this is why you see tidyverse conflicts when loading the package, because certain tidy packages are overriding other packages. The tidyverse is stealing names so to speak and it’s letting you know.</p>
<pre class="r"><code>library(tidyverse)
#&gt; ── Attaching packages ───────────────────────────────────── tidyverse 1.2.1 ──
#&gt; ✔ ggplot2 3.2.1     ✔ purrr   0.3.3
#&gt; ✔ tibble  2.1.3     ✔ dplyr   0.8.3
#&gt; ✔ tidyr   1.0.0     ✔ stringr 1.4.0
#&gt; ✔ readr   1.3.1     ✔ forcats 0.4.0
#&gt; ── Conflicts ──────────────────────────────────────── tidyverse_conflicts() ──
#&gt; ✖ dplyr::filter() masks stats::filter()
#&gt; ✖ dplyr::lag()    masks stats::lag()</code></pre>
</div>
<div id="demonstration" class="section level2">
<h2>Demonstration</h2>
<p>To show off shiny modules, I thought it might be interesting to rewrite a shiny app I made in the past. This way, we can compare the two. The app I’m rewritting can be found <a href="https://github.com/tyluRp/brewr-shiny"><strong>here</strong></a>, it’s just a simple app I made to play with the <a href="https://github.com/tyluRp/brewr"><strong>brewr</strong></a> package I wrote. A demo to the app can be found <a href="https://tylurp.shinyapps.io/brewr-shiny/"><strong>here</strong></a>.</p>
<div id="packages" class="section level3">
<h3>Packages</h3>
<p>The following packages are used:</p>
<pre class="r"><code>library(shiny)    # app framework
library(ggplot2)  # plotting
library(ggsci)    # color scales
library(forcats)  # reordering factors
library(jsonlite) # easy json to dataframe
library(brewr)    # homebrew json api wrapper
library(readr)    # convert datatypes easily
library(curl)     # need so shiny wont complain
library(glue)     # better paste0
library(cli)      # console tools
library(crayon)   # console colors</code></pre>
<p>Can’t remember why shiny complained without the curl package? I probably did something wrong but oh well, moving on.</p>
</div>
<div id="user-interface" class="section level3">
<h3>User interface</h3>
<p>The interface is pretty simple. We have a left panel with some <code>selectInputs</code>, a <code>sliderInput</code>, and a <code>dataTableOutput</code>. On the right, we have a <code>mainPanel</code> which renders the graphic. This graphic will change depending on the options the user configures. These options include:</p>
<ol style="list-style-type: decimal">
<li>Category</li>
<li>Days</li>
<li>Slider Range</li>
</ol>
<p><img src="/img/brewr-shiny-ui.png" width="100%" /></p>
</div>
<div id="creating-a-shiny-module" class="section level3">
<h3>Creating a shiny module</h3>
<p>Currently, this app is bundled into a single <a href="https://github.com/tyluRp/brewr-shiny/blob/master/app.R"><strong><code>app.R</code></strong></a> file, it talks to a few other other files like <code>styles.css</code> but for the most part it’s all in <code>app.R</code>. Consider the following <code>selectInput</code>:</p>
<pre class="r"><code>column(
  width = 8, 
  selectInput(
    inputId = &quot;category&quot;, 
    label   = &quot;Category:&quot;, 
    choices = c(
      &quot;Install Events&quot;            = &quot;/analytics/install&quot;,
      &quot;Install On Request Events&quot; = &quot;/analytics/install-on-request&quot;,
      &quot;Build Error Events&quot;        = &quot;/analytics/build-error&quot;,
      &quot;macOS Versions for Events&quot; = &quot;/analytics/os-version&quot;
    ), 
    width = 215
  )
)</code></pre>
<p>We can put this in a module by defining the UI and Server logic, similar to a normal shiny app:</p>
<pre class="r"><code># Module UI function
ui_SelectEvent &lt;- function(id, label = &quot;Event:&quot;) {
  
  # Create a namespace function using the provided id
  ns &lt;- NS(id)
  
  tagList( 
    selectInput(
      inputId = ns(&quot;event&quot;), 
      label   = &quot;Event:&quot;, 
      width   = 215,
      choices = c(
        &quot;Install Events&quot;            = &quot;/analytics/install&quot;,
        &quot;Install On Request Events&quot; = &quot;/analytics/install-on-request&quot;,
        &quot;Build Error Events&quot;        = &quot;/analytics/build-error&quot;,
        &quot;macOS Versions for Events&quot; = &quot;/analytics/os-version&quot;)
    )
  )
}
# Modules Server function
srv_SelectEvent &lt;- function(input, output, session) {
  selectedEvent &lt;- reactive({
    input$event
  })
}</code></pre>
<p>So there a couple of things to unpack here and I’m gonna do my best to go through them one by one.</p>
<ol style="list-style-type: decimal">
<li>Naming convension: You’ll notice I’ve named the functions with a prefix (<code>ui_</code>, <code>srv_</code>), this is to help me recognize which functions belong where. Joe Cheng offers a different approach which you should probably follow<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>.</li>
<li>The first argument is <code>id</code> and this is <strong>required</strong> because it serves as the namespace for the module.</li>
<li>Building off of point 2, the contents of the function starts with <code>ns &lt;- NS(id)</code>. It’s my understanding that this is also required, it takes the string <code>id</code> in order to create a namespace function.</li>
<li>The <code>inputId</code> is wrapped in an <code>ns()</code> call. Any inputs or outputs must be wrapped around <code>ns()</code>.</li>
<li>The <code>selectInput</code> is wrapped in a <code>tagList()</code> call. In this example, I don’t think it’s actually needed because we aren’t passing along multiple UI components, just a single dropdown menu.</li>
<li>The server function has 3 arguments and they’re all required. Additionally, you can create additional arguments like <code>stringsAsFactors</code> for example.</li>
<li>The input, output, and session arguments are special in that they can only access names that match up with the UI.</li>
<li><code>input$event</code> is referring to <code>ns(&quot;event&quot;)</code>.</li>
<li>Because of point 7, the inputs, outputs, and session arguments cannot be used to access inputs and outputs outside of its namespace. This is by design to prevent users from writing modules that implicitly interact with the app. The goal is to make interactions explicit.</li>
</ol>
<p>Again, I’m more or less rehashing what’s already been written by Joe Cheng so I encourage you to take a look if you’re lost.</p>
</div>
<div id="using-the-module" class="section level3">
<h3>Using the module</h3>
<p>Consider that the chunk of code above is saved in a folder called “modules”. We can make that module accessible to <code>app.R</code> by sourcing it with the <code>source</code> function. In one example, consider that I have created two folders: <code>functions</code> and <code>modules</code>. I can source all my functions and modules by placing these lines of code after loading all the necessary packages:</p>
<pre class="r"><code># list all module files
modules &lt;- list.files(&#39;modules&#39;, full.names = TRUE)
# list all function files
functions &lt;- list.files(&#39;functions&#39;, full.names = TRUE)
# create an object that has both modules and functions
imports &lt;- c(modules, functions)
# loop through them all and run the source function
sapply(imports, source)</code></pre>
<p>At the end a simple shiny app with a single <code>sliderInput</code> would like this:</p>
<pre class="r"><code>library(shiny)
modules &lt;- list.files(&#39;modules&#39;, full.names = TRUE)
functions &lt;- list.files(&#39;functions&#39;, full.names = TRUE)
imports &lt;- c(modules, functions)
sapply(imports, source)
ui &lt;- fluidPage(
  ui_SelectEvent(&quot;event&quot;)
)
server &lt;- function(input, output, session) {
  event &lt;- callModule(srv_SelectEvent, &quot;event&quot;)
}
# Run the application 
shinyApp(ui, server)</code></pre>
<p>However, another option would be to use a <code>global.R</code> file which is my preferred method of loading libraries and sourcing functions/modules in a shiny app. The <code>global.R</code> file is ran before the shiny app and so you can have a “start up” script that contains everything necessary to make the app start. Keep in mind that this requires the app be split into <code>ui.R</code> and <code>server.R</code>.</p>
<p>In my final modularized shiny app, <code>global.R</code> looks like this:</p>
<pre class="r"><code>library(shiny)    # app framework
library(ggplot2)  # plotting
library(ggsci)    # color scales
library(forcats)  # reordering factors
library(jsonlite) # easy json to dataframe
library(brewr)    # homebrew json api wrapper
library(readr)    # convert datatypes easily
library(curl)     # need so shiny wont complain
library(glue)     # better paste0
library(cli)      # console tools
library(crayon)   # console colors
modules &lt;- list.files(&#39;modules&#39;, full.names = TRUE)
functions &lt;- list.files(&#39;functions&#39;, full.names = TRUE)
imports &lt;- c(modules, functions)
sapply(imports, source)</code></pre>
<p>The structure of my project looks like this <a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>:</p>
<pre><code>#&gt; brewr-shiny-modules
#&gt; ├─brewr-shiny-modules.Rproj
#&gt; ├─ui.R
#&gt; ├─server.R
#&gt; ├─global.R
#&gt; ├─functions
#&gt; │ ├─brewr_plot.R
#&gt; │ └─transform_data.R
#&gt; └─modules
#&gt;   ├─selectDays.R
#&gt;   ├─selectEvent.R
#&gt;   └─sliderRange.R</code></pre>
<p>You can find the source code <a href="https://github.com/tyluRp/brewr-shiny-modules"><strong>here</strong></a>.</p>
</div>
<div id="careful-design" class="section level3">
<h3>Careful Design</h3>
<p>If used carefully, shiny modules are a great way to organize, manage, and debug your application. If used without care, shiny modules can seem like more work than is necessary. This isn’t a critique on shiny modules, it’s more so an idea that rings true to most programming projects in general. Without thoughtful decisions about the modules design, we invite unnecessary problems to the application. One problem might be implicit interactions between modules that makes the application difficult to decipher.</p>
</div>
<div id="conclusion" class="section level3">
<h3>Conclusion</h3>
<p>If you’re developing a large shiny application, consider implementing shiny modules to save yourself from giant, unreadable scripts. The benefits are plenty worth it and if designed thoughfully, will save yourself time in the future by reusing modules for other parts of the app or for future projects.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p><a href="https://shiny.rstudio.com/articles/modules.html" class="uri">https://shiny.rstudio.com/articles/modules.html</a><a href="#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p>Tree console diagram made with <a href="https://github.com/r-lib/cli">cli</a> package.<a href="#fnref2" class="footnote-back">↩</a></p></li>
</ol>
</div>

    </div>
    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="/post/my-first-cran-package/">
                <span class="button__icon">←</span>
                <span class="button__text">My First CRAN Package</span>
              </a>
            </span>
          
          
            <span class="button next">
              <a href="/post/testing-equality-of-multiple-expressions/">
                <span class="button__text">Testing Equality of Multiple Expressions</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
    

    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">tyler littlefield</span>
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span>© 2019 Powered by <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a></span>
        <span>Theme created by <a href="https://twitter.com/panr" target="_blank" rel="noopener">panr</a></span>
      </div>
    
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>


      
    </div>

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-106175087-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
  </body>
</html>
