<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.42.1" />


<title>treeco: eco benefits in R - tyluRp</title>
<meta property="og:title" content="treeco: eco benefits in R - tyluRp">



  








<link href='//cdn.bootcss.com/highlight.js/9.11.0/styles/github.min.css' rel='stylesheet' type='text/css' />



<link rel="stylesheet" href="/css/fonts.css" media="all">
<link rel="stylesheet" href="/css/main.css" media="all">



  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="/" class="nav-logo">
    <img src="/images/ein.png"
         width="50"
         height="50"
         alt="Logo">
  </a>

  <ul class="nav-links">
    
    <li><a href="/about/">About</a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">

  <article class="article">
    
    <span class="article-duration">7 min read</span>
    

    <h1 class="article-title">treeco: eco benefits in R</h1>

    
    <span class="article-date">2018/09/02</span>
    

    <div class="article-content">
      

<p>I&rsquo;m excited to say that I&rsquo;ve developed my first R package <a href="https://github.com/tyluRp/treeco"><code>treeco</code></a>, a tool for calculating the eco benefits of trees. To my suprise, it&rsquo;s not that difficult to actually develope a package. With tools like <a href="https://github.com/r-lib/usethis"><code>usethis</code></a> which makes the developement process easy, the main challenge is simply coming up with an idea. I probably never would have thought of <code>treeco</code> if I didn&rsquo;t work at software company dedicated to trees.</p>

<h1 id="how-it-works">How it works</h1>

<p>There are currently two functions: <code>eco_run</code> and <code>eco_run_all</code>. The former calculates benefits for a single tree and the latter calculates benefits for multiple trees.</p>

<p><code>eco_run</code> requires a common name, a dbh<sup class="footnote-ref" id="fnref:Diameter-at-brea"><a href="#fn:Diameter-at-brea">1</a></sup> value and a region code. For example:</p>

<pre><code class="language-r">treeco::eco_run(&quot;Common fig&quot;, 20, &quot;InlEmpCLM&quot;)
</code></pre>

<pre><code>##     common_name dbh benefit_value            benefit unit dollars
##  1:  Common fig  20        0.2429     aq nox avoided   lb    0.93
##  2:  Common fig  20        0.2623         aq nox dep   lb    1.01
##  3:  Common fig  20        0.7716       aq ozone dep   lb    2.96
##  4:  Common fig  20        0.0602    aq pm10 avoided   lb    0.28
##  5:  Common fig  20        0.4079        aq pm10 dep   lb    1.89
##  6:  Common fig  20        0.4813     aq sox avoided   lb    1.17
##  7:  Common fig  20        0.0353         aq sox dep   lb    0.09
##  8:  Common fig  20        0.0602     aq voc avoided   lb    0.12
##  9:  Common fig  20        0.0000               bvoc   lb    0.00
## 10:  Common fig  20      122.7973        co2 avoided   lb    0.41
## 11:  Common fig  20        9.0389    co2 sequestered   lb    0.03
## 12:  Common fig  20     1255.7516        co2 storage   lb    4.19
## 13:  Common fig  20      189.2000        electricity  kwh   38.12
## 14:  Common fig  20      834.7837 hydro interception  gal    4.59
## 15:  Common fig  20     -179.4561        natural gas   lb    1.20
</code></pre>

<p>Why require the obscure region code? I wish we didn&rsquo;t need it but the benefits of a tree vary depending on the region. For now, users can find the region code by looking at the <code>money</code> dataset:</p>

<pre><code class="language-r">treeco::money[c(&quot;region_code&quot;, &quot;region_name&quot;)]
</code></pre>

<pre><code>##     region_code               region_name
## 1     CaNCCoJBK Northern California Coast
## 2     CenFlaXXX           Central Florida
## 3     GulfCoCHS             Coastal Plain
## 4     InlEmpCLM             Inland Empire
## 5     InlValMOD            Inland Valleys
## 6     InterWABQ             Interior West
## 7     LoMidWXXX             Lower Midwest
## 8     MidWstMSP                   Midwest
## 9     NMtnPrFNL                     North
## 10    NoEastXXX                 Northeast
## 11    PacfNWLOG         Pacific Northwest
## 12    PiedmtCLT                     South
## 13    SoCalCSMA Southern California Coast
## 14    SWDsrtGDL          Southwest Desert
## 15    TpIntWBOI   Temperate Interior West
## 16 TropicPacXXX                  Tropical
</code></pre>

<p>What about typos in the common name argument? This is something I haven&rsquo;t quite figured out yet. For now, users can look at the <code>species</code> dataset or just type something in and see if <code>eco_run</code> correctly guesses what the user meant. For example, we might misspell &ldquo;Common fig&rdquo; as &ldquo;Comon fig&rdquo;:</p>

<pre><code class="language-r">treeco::eco_run(&quot;Comon fig&quot;, 20, &quot;InlEmpCLM&quot;)
</code></pre>

<pre><code>## Species given: [comon fig]
## Closest match: [common fig]
## ...
## Using closest match
</code></pre>

<pre><code>##     common_name dbh benefit_value            benefit unit dollars
##  1:  Common fig  20        0.2429     aq nox avoided   lb    0.93
##  2:  Common fig  20        0.2623         aq nox dep   lb    1.01
##  3:  Common fig  20        0.7716       aq ozone dep   lb    2.96
##  4:  Common fig  20        0.0602    aq pm10 avoided   lb    0.28
##  5:  Common fig  20        0.4079        aq pm10 dep   lb    1.89
##  6:  Common fig  20        0.4813     aq sox avoided   lb    1.17
##  7:  Common fig  20        0.0353         aq sox dep   lb    0.09
##  8:  Common fig  20        0.0602     aq voc avoided   lb    0.12
##  9:  Common fig  20        0.0000               bvoc   lb    0.00
## 10:  Common fig  20      122.7973        co2 avoided   lb    0.41
## 11:  Common fig  20        9.0389    co2 sequestered   lb    0.03
## 12:  Common fig  20     1255.7516        co2 storage   lb    4.19
## 13:  Common fig  20      189.2000        electricity  kwh   38.12
## 14:  Common fig  20      834.7837 hydro interception  gal    4.59
## 15:  Common fig  20     -179.4561        natural gas   lb    1.20
</code></pre>

<p><code>eco_run_all</code> requires a dataset in the form of a csv, the name of the common name field, the name of the dbh field, and the region:</p>

<pre><code class="language-r">file_dir &lt;- &quot;/Users/tylerlittlefield/Desktop/treeco demo data/trees.csv&quot;

my_trees &lt;- treeco::eco_run_all(
  data = file_dir,        # data directory
  species_col = &quot;COMMON&quot;, # name of my common name field
  dbh_col = &quot;EXACT_DBH&quot;,  # name of my dbh field
  region = &quot;InlEmpCLM&quot;    # region
  )
</code></pre>

<pre><code>## Time difference of 0.828387 secs
</code></pre>

<pre><code class="language-r">tibble::as_tibble(my_trees)
</code></pre>

<pre><code>## # A tibble: 99,690 x 8
##       id scientific_name common_name   dbh benefit_value benefit unit 
##    &lt;int&gt; &lt;chr&gt;           &lt;chr&gt;       &lt;dbl&gt;         &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;
##  1     1 Cupaniopsis an… Carrot wood    15        0.129  aq nox… lb   
##  2     1 Cupaniopsis an… Carrot wood    15        0.242  aq nox… lb   
##  3     1 Cupaniopsis an… Carrot wood    15        0.628  aq ozo… lb   
##  4     1 Cupaniopsis an… Carrot wood    15        0.0317 aq pm1… lb   
##  5     1 Cupaniopsis an… Carrot wood    15        0.350  aq pm1… lb   
##  6     1 Cupaniopsis an… Carrot wood    15        0.254  aq sox… lb   
##  7     1 Cupaniopsis an… Carrot wood    15        0.0243 aq sox… lb   
##  8     1 Cupaniopsis an… Carrot wood    15        0.0317 aq voc… lb   
##  9     1 Cupaniopsis an… Carrot wood    15       -0.569  bvoc    lb   
## 10     1 Cupaniopsis an… Carrot wood    15       64.8    co2 av… lb   
## # ... with 99,680 more rows, and 1 more variable: dollars &lt;dbl&gt;
</code></pre>

<p>Similar to <code>eco_run</code> the output follows the &ldquo;tidy&rdquo; data structure<sup class="footnote-ref" id="fnref:Tidy-data-is-an"><a href="#fn:Tidy-data-is-an">2</a></sup> where:</p>

<ol>
<li>Each variable has its own column</li>
<li>Each observation has its own row</li>
<li>Each value has its own cell. This lets users manipulate and summarise the data easily.</li>
</ol>

<p>Once the numbers have been crunched, we can use the <code>my_trees</code> object to explore the results.</p>

<pre><code class="language-r">library(dplyr)
library(ggplot2)
library(forcats)
library(stringr)

# Theme I'll be using for the next couple plots
theme_treeco &lt;- function() {
  theme_minimal() +
  theme(text = element_text(family = &quot;MyriadPro-Regular&quot;),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.y = element_blank())
}

# Top 10 species
my_trees %&gt;% 
  group_by(common_name) %&gt;% 
  tally() %&gt;% 
  top_n(10) %&gt;% 
  arrange(desc(n)) %&gt;% 
  ggplot(aes(fct_reorder(common_name, n), n)) +
  geom_col(fill = &quot;#7BA46C&quot;) + 
  scale_y_continuous(labels = scales::comma) +
  labs(x = &quot;&quot;, y = &quot;Count&quot;) +
  coord_flip() +
  theme_treeco()
</code></pre>

<p><img src="/post/2018-09-02-treeco-eco-benefits-in-r_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>

<pre><code class="language-r"># Top 10 most valuable tree species in our inventory
my_trees %&gt;% 
  group_by(common_name) %&gt;% 
  summarise(total_dollars = sum(dollars)) %&gt;% 
  top_n(10) %&gt;% 
  arrange(desc(total_dollars)) %&gt;% 
  ggplot(aes(fct_reorder(common_name, total_dollars), total_dollars)) +
  geom_col(fill = &quot;#7BA46C&quot;) +
  scale_y_continuous(labels = scales::dollar) +
  labs(x = &quot;&quot;, y = &quot;Total Dollars&quot;) +
  coord_flip() +
  theme_treeco()
</code></pre>

<p><img src="/post/2018-09-02-treeco-eco-benefits-in-r_files/figure-html/unnamed-chunk-5-2.png" width="672" /></p>

<pre><code class="language-r"># Total CO2 benefits
# Total CO2 benefits
my_trees %&gt;% 
  filter(str_detect(benefit, &quot;co2&quot;)) %&gt;% 
  group_by(benefit) %&gt;% 
  summarise(total_benefits = sum(benefit_value)) %&gt;% 
  ggplot(aes(fct_reorder(benefit, total_benefits), total_benefits)) +
  geom_col(fill = &quot;#7BA46C&quot;) +
  scale_y_continuous(labels = scales::comma) +
  labs(x = &quot;&quot;, y = &quot;Total Pounds&quot;) +
  coord_flip() +
  theme_treeco()
</code></pre>

<p><img src="/post/2018-09-02-treeco-eco-benefits-in-r_files/figure-html/unnamed-chunk-5-3.png" width="672" /></p>

<p>There are many other variables to play around with. Each tree has 15, they are:</p>

<ol>
<li>aq nox avoided</li>
<li>aq nox dep</li>
<li>aq ozone dep</li>
<li>aq pm10 avoided</li>
<li>aq pm10 dep</li>
<li>aq sox avoided</li>
<li>aq sox dep</li>
<li>aq voc avoided</li>
<li>bvoc</li>
<li>co2 avoided</li>
<li>co2 sequestered</li>
<li>co2 storage</li>
<li>electricity</li>
<li>hydro interception</li>
<li>natural gas</li>
</ol>

<p>More information on these benefits can be found at Davey Trees benefit <a href="http://www.treebenefits.com/calculator/">calculator</a> which I have been using to &ldquo;spot check&rdquo; trees and confirm that the numbers <code>treeco</code> gives are accurate. In fact, I owe a lot to Davey Trees, OpenStreetMap, and (above all) i-Tree for making <code>treeco</code> possible.</p>

<p>OpenStreetMap has their source code hosted on github and is written in the Go language. This was a great resource and allowed me to translate some of the important bits to R.</p>

<p>i-Tree is essentially the &ldquo;standard&rdquo; eco reporting tool that Davey, OpenTreeMap and <code>treeco</code> are built upon. The benefit values are interpolated from values originally found in (I believe) i-Tree Streets. So without this data, we wouldn&rsquo;t be able to extract benefit values.</p>

<h1 id="future-plans">Future plans</h1>

<p>Overall, I&rsquo;m pretty happy with <code>treeco</code>. There are some issues with it and you can find them in the issues page on github, but it&rsquo;s at a point where I can use it and make my own custom eco benefit reports. In the future, I&rsquo;m hoping to make this package more user friendly and ultimately, usable for anyone. This means the code needs to be refined much more, it needs to be robust and be able to handle (or ideally, resolve) errors elegantly. I would also like to include <code>rmarkdown</code> in the package and have some <code>eco_report</code> function that creates a benefit report. Lastly (and this sorta relates the the first point), I want to break down the code into smaller, bite sized functions. I&rsquo;ve already started working on this but it is a work in progress at the moment.</p>

<p>That&rsquo;s all for now! I will update this post or maybe create a new one once there have been significant updates. If you happen to test out the package and find issues or possible enhancements, please file one on github!</p>
<div class="footnotes">

<hr />

<ol>
<li id="fn:Diameter-at-brea">Diameter at breast height, see <a href="https://en.wikipedia.org/wiki/Diameter_at_breast_height">here</a> for more. <a class="footnote-return" href="#fnref:Diameter-at-brea"><sup>[return]</sup></a></li>
<li id="fn:Tidy-data-is-an">Tidy data is an opinionated approach to data analysis. See <a href="http://r4ds.had.co.nz/tidy-data.html">here</a> for more information. <a class="footnote-return" href="#fnref:Tidy-data-is-an"><sup>[return]</sup></a></li>
</ol>
</div>

    </div>
  </article>

  
<section id="comments">
  <div id="disqus_thread"></div>
  <script>
  var disqus_config = function () {
  
  };
  (function() {
    var inIFrame = function() {
      var iframe = true;
      try { iframe = window.self !== window.top; } catch (e) {}
      return iframe;
    };
    if (inIFrame()) return;
    var d = document, s = d.createElement('script');
    s.src = '//tylurp-rbind-io.disqus.com/embed.js'; s.async = true;
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>



</main>

<script src="https://use.fontawesome.com/efb5af9857.js"></script>
      <footer class="footer">
        <ul class="footer-links">
            <li><a href="mailto:tylurp1@gmail.com"><i class="fa fa-envelope" aria-hidden="true" title="Mail to Tyler"></i><span class="sr-only">Email</span></a></li>
            <li><a href="https://github.com/tylurp"><i class="fa fa-github" aria-hidden="true" title="Github"></i><span class="sr-only">Github</span></a></li>
            <li><a href="https://twitter.com/tyluRp"><i class="fa fa-twitter" aria-hidden="true" title="Twitter"></i><span class="sr-only">Twitter</span></a></li>
            <li><a href="https://stackoverflow.com/users/7362046/tylurp?tab=profile"><i class="fa fa-stack-overflow" aria-hidden="true" title="Stack Overflow"></i><span class="sr-only">Stack Overflow</span></a></li>
            <li><a href="https://www.linkedin.com/in/tyler-littlefield-628662139/"><i class="fa fa-linkedin" aria-hidden="true" title="LinkedIn"></i><span class="sr-only">LinkedIn</span></a></li>
            <li><a href="/"><i title="Last change"></i> Last change: 2018/09/02</a></li>
        </ul>
        
          <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "tylurp-rbind-io" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        
      </footer>

    </div>
    



<script src="//cdn.bootcss.com/highlight.js/9.11.0/highlight.min.js"></script>



<script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/r.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/yaml.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



    

    
<script>
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-106175087-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

  </body>
</html>

